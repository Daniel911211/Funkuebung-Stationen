<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Funkübung – Geofence-Station</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;margin:0;padding:2rem;line-height:1.5;background:#f7f8fb;color:#111}
    .card{max-width:820px;margin:auto;border:1px solid #e5e7ef;border-radius:16px;padding:1.25rem;box-shadow:0 1px 8px rgba(0,0,0,.06);background:#fff}
    h1{margin-top:0}
    .ok{border-left:8px solid #2e7d32;padding-left:1rem}
    .warn{border-left:8px solid #c62828;padding-left:1rem}
    .small{color:#555;font-size:.9rem}
    button{font-size:1rem;padding:.6rem 1rem;border-radius:10px;border:1px solid #888;background:#fafafa;cursor:pointer}
    .meta{color:#555;font-size:.9rem;margin-top:.25rem}
    .imgwrap img{max-width:100%;height:auto;border:1px solid #e5e7ef;border-radius:8px}
  </style>
</head>
<body>
  <div class="card">
    <h1>Funkübung – Station: Brüder-Grimm-Straße 12 (Rommerz)</h1>
    <div class="small meta">
      Zielkoordinate: 50.450761, 9.614064 · Radius: 60 m
    </div>
    <p class="small">
      Diese Seite prüft per GPS, ob ihr am richtigen Standort seid. Wenn ja, werden Hinweis & Aufgabe angezeigt.
    </p>

    <div id="status" class="warn">
      <p><strong>Status:</strong> Noch kein Standort geprüft.</p>
      <p>Klicke auf <em>Standort prüfen</em> und erlaube dem Browser den Zugriff auf den Standort.</p>
    </div>

    <p><button id="btn">Standort prüfen</button></p>

    <div id="content" style="display:none" class="ok">
      <h2>Hinweis & Aufgabe</h2>
      <p><strong>Hinweis-Buchstabe:</strong> <span id="hint">—</span> <span class="small">(wird durch die Einsatzleitung je Fahrzeug festgelegt)</span></p>
      <p><strong>Aufgabe:</strong> Buchstabierübung: Zentrale nennt ein Wort, ihr buchstabiert nach Funkalphabet zurück.</p>
      
    </div>

    <hr>
    <details>
      <summary>Info & Konfiguration</summary>
      <p class="small">
        <strong>Station:</strong> Brüder-Grimm-Straße 12 (Rommerz)<br>
        <strong>Koordinaten (WGS84):</strong> 50.450761, 9.614064<br>
        <strong>Radius:</strong> 60 m
      </p>
    </details>
  </div>

<script>
const TARGET_LAT = 50.450761;
const TARGET_LNG = 9.614064;
const RADIUS_M   = 60;

function haversine(lat1, lon1, lat2, lon2){
  const toRad = d => d * Math.PI / 180;
  const R = 6371000;
  const dLat = toRad(lat2-lat1);
  const dLon = toRad(lon2-lon1);
  const a = Math.sin(dLat/2)**2 + Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
  const c = 2 * Math.atan2(Math.sqrt(1-a), Math.sqrt(a));
  return R * c;
}

const statusBox = document.getElementById("status");
const btn = document.getElementById("btn");
const content = document.getElementById("content");

function setStatusOk(text){
  statusBox.className = "ok";
  statusBox.innerHTML = `<p><strong>Status:</strong> ${text}</p>`;
}

function setStatusWarn(text){
  statusBox.className = "warn";
  statusBox.innerHTML = `<p><strong>Status:</strong> ${text}</p>`;
}

btn.addEventListener("click", () => {
  if(!navigator.geolocation){
    setStatusWarn("Geolocation wird von diesem Gerät/Browser nicht unterstützt.");
    return;
  }
  setStatusWarn("Bitte Standortfreigabe erlauben …");
  navigator.geolocation.getCurrentPosition(pos => {
    const { latitude, longitude, accuracy } = pos.coords;
    const dist = haversine(latitude, longitude, TARGET_LAT, TARGET_LNG);
    if(dist <= RADIUS_M){
      setStatusOk(`Am richtigen Ort (≈ ${Math.round(dist)} m, Genauigkeit ±${Math.round(accuracy)} m).`);
      content.style.display = "block";
    }else{
      setStatusWarn(`Nicht am richtigen Ort (Entfernung ≈ ${Math.round(dist)} m, Zielradius 60 m).`);
      content.style.display = "none";
    }
  }, err => {
    if(err.code === err.PERMISSION_DENIED){
      setStatusWarn("Standortfreigabe wurde abgelehnt. Ohne GPS kann die Aufgabe nicht freigeschaltet werden.");
    }else{
      setStatusWarn("Standort konnte nicht ermittelt werden. Versucht es erneut (Daten/GPS aktivieren).");
    }
  }, { enableHighAccuracy:true, timeout:10000, maximumAge:0 });
});
</script>
</body>
</html>
