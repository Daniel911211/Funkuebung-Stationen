<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FunkÃ¼bung â€“ Station: Frankfurter Str. 38A (Neuhof)</title>
  <style>
    :root { --brand:#c62828; --ok:#2e7d32; --warn:#c62828; --bg:#f7f8fb; --card:#ffffff; --border:#e5e7ef; --text:#111; --muted:#555; }
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;margin:0;padding:16px;line-height:1.5;background:var(--bg);color:var(--text);}
    .card{max-width:860px;margin:auto;background:var(--card);border:1px solid var(--border);border-radius:18px;box-shadow:0 1px 10px rgba(0,0,0,.06);}
    .header{display:flex;align-items:center;gap:10px;padding:16px;border-bottom:1px solid var(--border);}
    .icon{font-size:28px;}
    .wrap{padding:16px;}
    .status{padding:12px;border-left:8px solid var(--warn);border-radius:10px;margin-top:10px;}
    .status.ok{border-left-color:var(--ok);}
    .btn{margin-top:10px;padding:.7rem 1.2rem;font-weight:700;border-radius:10px;border:2px solid var(--warn);color:var(--warn);background:#fff;cursor:pointer;}
    .btn.success{background:var(--ok);color:#fff;border-color:var(--ok);}
    .task{margin-top:20px;border:1px dashed var(--border);padding:14px;border-radius:10px;}
    .task h2{text-decoration:underline;color:var(--brand);}
    .muted{color:var(--muted);}
    .gate{margin-top:14px;border:1px solid var(--border);padding:12px;border-radius:10px;}
    .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px;}
    input[type="text"]{padding:.6rem .7rem;border:1px solid var(--border);border-radius:10px;min-width:220px;}
    .out strong{color:#c62828;}
  </style>
</head>
<body>
  <div class="card">
    <div class="header">
      <div class="icon">ðŸš’</div>
      <h1>FunkÃ¼bung â€“ Station: Frankfurter Str. 38A (Neuhof)</h1>
    </div>
    <div class="wrap">
      <div id="status" class="status warn"><strong>Status:</strong> Noch kein Standort geprÃ¼ft.</div>
      <button id="btn" class="btn danger">Standort prÃ¼fen</button>

      <div id="content" style="display:none">
        <div class="task">
          <h2>Hinweis &amp; Aufgabe</h2>
          <p><strong>Aufgabe:</strong> Meldet euch Ã¼ber Funk bei der Ãœbungsleitung. Ihr erhaltet ein <em>Abfragewort</em>. Gebt es unten ein, um eure Aufgabe anzeigen zu lassen.</p>
          <p><strong>Hinweis-Buchstabe:</strong> <span id="hint">â€”</span> <span class="muted"></span></p>

          <div id="wordGate" class="gate" style="display:none">
            <h3 style="margin:0 0 6px 0;">Freischaltung per Abfragewort</h3>
            <p class="muted">Abfragewort von der Ãœbungsleitung eingeben (GroÃŸ-/Kleinschreibung egal).</p>
            <div class="row">
              <input id="wordInput" type="text" autocomplete="off" placeholder="Abfragewort">
              <button id="wordBtn" class="btn danger" type="button">Wort prÃ¼fen</button>
            </div>
            <div id="wordMsg" class="muted" style="margin-top:8px;"></div>
          </div>

          <div id="out" class="out" style="display:none; margin-top:12px">
            <p><strong>Anzurufendes FHZ:</strong> <span id="outCall"></span></p>
            <p><strong>Frage:</strong> <span id="outQuestion"></span></p>
            <p>LÃ¶sungsbuchstabe und Positionscode weitergeben (auch wenn falsch beantwortet wurde).</p>
            <p><strong>LÃ¶sungsbuchstabe:</strong> <strong id="outLetter"></strong></p>
            <p><strong>Positionscode:</strong> <strong id="outCode"></strong></p>
            
          </div>
        </div>
      </div>

      <details>
        <summary>Koordinaten</summary>
        <p class="muted"><strong>Koordinaten (WGS84):</strong> 50.450764, 9.614117<br><strong>Radius:</strong> 60 m</p>
      </details>
    </div>
  </div>
</body>
  <script>
// === Geofence / Zielkoordinate ===
const TARGET_LAT = 50.450764;
const TARGET_LNG = 9.614117;
const RADIUS_M   = 60;

// === Elemente ===
const statusBox = document.getElementById("status");
const btn       = document.getElementById("btn");
const content   = document.getElementById("content");

// (Optional â€“ falls du spÃ¤ter ein Abfragewort-Gate nutzen willst)
const wordGate  = document.getElementById("wordGate");
const wordInput = document.getElementById("wordInput");
const wordBtn   = document.getElementById("wordBtn");
const wordMsg   = document.getElementById("wordMsg");
const outBox    = document.getElementById("out");
const outCall   = document.getElementById("outCall");
const outQ      = document.getElementById("outQuestion");
const outLetter = document.getElementById("outLetter");
const outCode   = document.getElementById("outCode");
const hintSpan  = document.getElementById("hint");

// AbfragewÃ¶rter (nur nÃ¶tig, wenn du das Gate nutzt)
const WORD_PAYLOAD = {
  // Voll-Variante (6 FHZ) â€“ Beispiele (kannst du beibehalten/anpassen)
  "ANTON":     { call:"NHF 1/46/2", question:"Welche Pumpe ist im TSF verbaut?",                                  letter:"U", code:"W2P7" },
  "BERTA":     { call:"NHF 1/64/1", question:"Wie viele EinsatzkrÃ¤fte kann euer Fahrzeug maximal aufnehmen?",    letter:"A", code:"W3P6" },
  "Julius":     { call:"NHF 1/19/1", question:"Welche Materialien/AusrÃ¼stungen transportiert ihr mit dem GW-L?",  letter:"A", code:"W4P5" },
  "DORA":      { call:"NHF 1/47/1", question:"Wie viele SaugschlÃ¤uche fÃ¼hrt euer Fahrzeug mit?",                 letter:"E", code:"W5P4" },
  "EMIL":      { call:"NHF 1/11/1", question:"Welche technischen GerÃ¤te nutzt ihr zur Menschenrettung bei VU?",  letter:"E", code:"W6P3" },
  "FRIEDRICH": { call:"NHF 1/46/1", question:"Welche Aufgaben hat der Einsatzleitwagen an der Einsatzstelle?",   letter:"I", code:"W1P8" },

  // â€” Varianten â€”
  // Variante 4: FHZ 4 stellt Frage an FHZ 1 â†’ FHZ 1 bekommt E / W6P3
  "KAUFMANN":  { call:"NHF 1/46/1", question:"(Var. 4) FHZ 4 â†’ FHZ 1: Wie viele SaugschlÃ¤uche fÃ¼hrt euer Fahrzeug mit?", letter:"E", code:"W6P3" },

  // Variante 5: FHZ 5 stellt Frage an FHZ 1 â†’ FHZ 1 bekommt I / W1P8
  "PAULA":     { call:"NHF 1/46/1", question:"(Var. 5) FHZ 5 â†’ FHZ 1: Welche technischen GerÃ¤te nutzt ihr zur Menschenrettung bei VU?", letter:"I", code:"W1P8" },
};

// Eingabe normalisieren (Umlaute, GroÃŸschreibung, Leerzeichen)
function norm(s){
  return (s || "")
    .toUpperCase()
    .replace(/\s+/g,"")
    .replace(/Ã„/g,"AE").replace(/Ã–/g,"OE").replace(/Ãœ/g,"UE").replace(/ÃŸ/g,"SS");
}

// Haversine
function haversine(lat1, lon1, lat2, lon2){
  const toRad = d => d * Math.PI / 180, R = 6371000;
  const dLat = toRad(lat2-lat1), dLon = toRad(lon2-lon1);
  const a = Math.sin(dLat/2)**2 + Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
  return 2 * R * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
}

// UI-Helfer
function setStatusOk(text){
  statusBox.classList.remove("warn");
  statusBox.classList.add("ok");
  statusBox.innerHTML = `<strong>Status:</strong> ${text}`;
  btn.classList.add("success");
}
function setStatusWarn(text){
  statusBox.classList.remove("ok");
  statusBox.classList.add("warn");
  statusBox.innerHTML = `<strong>Status:</strong> ${text}`;
  btn.classList.remove("success");
}
function resetGate(){
  if (!wordGate) return;
  if (hintSpan)  hintSpan.textContent = "â€”";
  wordInput.value = "";
  wordMsg.textContent = "";
  wordGate.style.display = "none";
  if (outBox) outBox.style.display = "none";
}

// Button: Standort prÃ¼fen
btn.addEventListener("click", () => {
  if(!navigator.geolocation){
    setStatusWarn("Geolocation wird nicht unterstÃ¼tzt.");
    return;
  }
  resetGate();
  setStatusWarn("Bitte Standortfreigabe erlauben â€¦");

  navigator.geolocation.getCurrentPosition(pos => {
    const { latitude, longitude, accuracy } = pos.coords;
    const dist = haversine(latitude, longitude, TARGET_LAT, TARGET_LNG);
    if (dist <= RADIUS_M){
      setStatusOk(`Am richtigen Ort (â‰ˆ ${Math.round(dist)} m, Genauigkeit Â±${Math.round(accuracy)} m).`);
      content.style.display = "block";
      if (wordGate) wordGate.style.display = "block"; // Abfragewortfeld zeigen (falls genutzt)
    } else {
      setStatusWarn(`Nicht am richtigen Ort (Entfernung â‰ˆ ${Math.round(dist)} m, Zielradius ${RADIUS_M} m).`);
      content.style.display = "none";
    }
  }, err => {
    setStatusWarn("Standort konnte nicht ermittelt werden oder Zugriff verweigert.");
  }, { enableHighAccuracy:true, timeout:15000, maximumAge:0 });
});

// (Optional) Abfragewort-Logik â€“ nur aktiv, wenn wordBtn existiert
if (wordBtn){
  let tries = 0;
  wordBtn.addEventListener("click", () => {
    const payload = WORD_PAYLOAD[norm(wordInput.value)];
    if (payload){
      wordMsg.textContent = "Freigeschaltet âœ…";
      outCall.textContent   = payload.call;
      outQ.textContent      = payload.question;
      outLetter.textContent = payload.letter;
      outCode.textContent   = payload.code;
      if (hintSpan) hintSpan.innerHTML = `<strong style="color:#c62828;">${payload.letter}</strong>`;
      if (outBox) outBox.style.display = "block";
    } else {
      tries++;
      wordMsg.textContent = `Falsches Wort âŒ (Versuch ${tries}).`;
      if (tries >= 3){
        wordMsg.textContent += " Warte 15 Sekunden â€¦";
        wordBtn.disabled = true;
        setTimeout(()=>{ wordBtn.disabled=false; wordMsg.textContent=""; tries=0; }, 15000);
      }
    }
  });
}
</script>

</html>
