<script>
const TARGET_LAT = 50.450764;
const TARGET_LNG = 9.614117;
const RADIUS_M   = 60;

function haversine(lat1, lon1, lat2, lon2){
  const toRad = d => d * Math.PI / 180;
  const R = 6371000;
  const dLat = toRad(lat2 - lat1);
  const dLon = toRad(lon2 - lon1);
  const a = Math.sin(dLat/2)**2 + Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  return R * c;
}

const statusBox = document.getElementById("status");
const btn = document.getElementById("btn");
const content = document.getElementById("content");

function setStatusOk(text){
  statusBox.classList.remove("warn"); statusBox.classList.add("ok");
  statusBox.innerHTML = `<strong>Status:</strong> ${text}`;
  btn.classList.remove("danger"); btn.classList.add("success");
}
function setStatusWarn(text){
  statusBox.classList.remove("ok"); statusBox.classList.add("warn");
  statusBox.innerHTML = `<strong>Status:</strong> ${text}`;
  btn.classList.remove("success"); btn.classList.add("danger");
}

btn.addEventListener("click", () => {
  if(!navigator.geolocation){
    setStatusWarn("Geolocation wird von diesem Gerät/Browser nicht unterstützt.");
    return;
  }
  setStatusWarn("Bitte Standortfreigabe erlauben …");
  navigator.geolocation.getCurrentPosition(pos => {
    const { latitude, longitude, accuracy } = pos.coords;  // <-- nur einfache {}
    const dist = haversine(latitude, longitude, TARGET_LAT, TARGET_LNG);
    if(dist <= RADIUS_M){
      setStatusOk(`Am richtigen Ort (≈ ${Math.round(dist)} m, Genauigkeit ±${Math.round(accuracy)} m).`);
      content.style.display = "block";
    }else{
      setStatusWarn(`Nicht am richtigen Ort (Entfernung ≈ ${Math.round(dist)} m, Zielradius ${RADIUS_M} m).`);
      content.style.display = "none";
    }
  }, err => {
    if(err.code === err.PERMISSION_DENIED){
      setStatusWarn("Standortfreigabe wurde abgelehnt. Ohne GPS kann die Aufgabe nicht freigeschaltet werden.");
    }else{
      setStatusWarn("Standort konnte nicht ermittelt werden. Versucht es erneut (Daten/GPS aktivieren).");
    }
  }, { enableHighAccuracy:true, timeout:12000, maximumAge:0 }); // <-- nur einfache {}
});
</script>
